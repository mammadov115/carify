<!DOCTYPE html>
{% load number_format %}

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Favori avtomobillər</title>
    {% include "partials/global_meta_tags" %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" />
    <link rel="stylesheet" href="/static/index.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="/static/index.css" />


  </head>

  <body class="font-inter">
    {% include "partials/navbar.html" %}

    <div class="container mt-5">
      <div class="row">
        <!-- Filter -->
        {% comment %} <div class="col-12 col-lg-3 order-lg-1">
          <div class="bg-white shadow p-3 mb-3">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="statusFilter" id="auctionCheck" />
              <label class="form-check-label" for="auctionCheck">
                <i class="bi bi-currency-dollar gold-icon"></i>
                Hərrac maşınları
              </label>
            </div>

            <div class="form-check">
              <input class="form-check-input" type="radio" name="statusFilter" id="koreaStockCheck" checked />
              <label class="form-check-label" for="koreaStockCheck">
                <i class="bi bi-box-seam-fill korea-stock-icon"></i>
                Koreya stokumuz
              </label>
            </div>

            <div class="form-check">
              <input class="form-check-input" type="radio" name="statusFilter" id="onTheWayCheck" />
              <label class="form-check-label" for="onTheWayCheck">
                <i class="bi bi-truck on-the-way-icon"></i>
                Yolda satılır
              </label>
            </div>
          </div>

          <div class="bg-white shadow p-3 mt-2 mb-3">
            <select class="form-select mb-2" aria-label="Select Make">
              <option selected>Marka seçin...</option>
              <option value="1">Toyota</option>
              <option value="2">BMW</option>
            </select>

            <select class="form-select" aria-label="Select Model">
              <option selected>Model seçin...</option>
              <option value="1">Corolla</option>
              <option value="2">3 Series</option>
            </select>
          </div>

          <div class="bg-white shadow p-3 mt-2 mb-2">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="yearFilter" id="year2016Check" />
              <label class="form-check-label" for="year2016Check">2016</label>
            </div>

            <div class="form-check">
              <input class="form-check-input" type="radio" name="yearFilter" id="year2017Check" checked />
              <label class="form-check-label" for="year2017Check">2017</label>
            </div>

            <div class="form-check">
              <input class="form-check-input" type="radio" name="yearFilter" id="year2018Check" />
              <label class="form-check-label" for="year2018Check">2018</label>
            </div>
          </div>

          <input class="btn btn-primary w-100 mb-4" type="submit" value="Axtar" />
        </div> {% endcomment %}

        <!-- Cars -->
          <div class="col-12 col-lg-9 order-lg-2">
            <div class="row">
              <div class="col-6 col-lg-3 mb-2">
                <a href="{% url "home" %}" class="text-decoration-none">
                  <div class="card favorites-card text-center h-100">
                    <div class="card-body d-flex flex-column justify-content-center align-items-center">
                      <h5 class="card-title">Ana səhifə</h5>
                      <p class="card-text">Bütün avtomobillər</p>
                      <i class="bi bi-car-front-fill"></i>
                    </div>
                  </div>
                </a>
              </div>
              
              {% for car in cars %}
                {% include "partials/cars.html" %}
              {% endfor %}
            </div>

            <!-- Pagination -->
            <div class="row my-3">
              <div class="col">
                <nav aria-label="Page navigation example">
                  <ul class="pagination justify-content-center">
                    {# Previous #}
                    {% if page_obj.has_previous %}
                      <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Əvvəlki</a>
                      </li>
                    {% else %}
                      <li class="page-item disabled">
                        <a class="page-link">Əvvəlki</a>
                      </li>
                    {% endif %}

                    {# First page #}
                    {% if page_obj.number > 2 %}
                      <li class="page-item">
                        <a class="page-link" href="?page=1">1</a>
                      </li>
                      {% if page_obj.number > 3 %}
                        <li class="page-item disabled">
                          <a class="page-link">…</a>
                        </li>
                      {% endif %}
                    {% endif %}

                    {# Current -1, current, current +1 #}
                    {% for num in page_obj.paginator.page_range %}
                      {% if num >= page_obj.number|add:'-1' and num <= page_obj.number|add:'1' %}
                        {% if page_obj.number == num %}
                          <li class="page-item active">
                            <a class="page-link">{{ num }}</a>
                          </li>
                        {% else %}
                          <li class="page-item">
                            <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                          </li>
                        {% endif %}
                      {% endif %}
                    {% endfor %}

                    {# Last page #}
                    {% if page_obj.number < page_obj.paginator.num_pages|add:'-1' %}
                      {% if page_obj.number < page_obj.paginator.num_pages|add:'-2' %}
                        <li class="page-item disabled">
                          <a class="page-link">…</a>
                        </li>
                      {% endif %}
                      <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">{{ page_obj.paginator.num_pages }}</a>
                      </li>
                    {% endif %}

                    {# Next #}
                    {% if page_obj.has_next %}
                      <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.next_page_number }}">Növbəti</a>
                      </li>
                    {% else %}
                      <li class="page-item disabled">
                        <a class="page-link">Növbəti</a>
                      </li>
                    {% endif %}
                  </ul>
                </nav>
              </div>
            </div>
          </div>


      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js" integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y" crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $(document).ready(function () {
        $('.favorite-icon').click(function () {
          var icon = $(this)
          var carId = icon.data('car-id')
          var cardColumn = icon.closest('.col-6, .col-lg-3')  // Kartın parent col-u

          $.ajax({
            url: "{% url 'toggle_favorite' %}",
            method: 'POST',
            data: {
              car_id: carId,
              csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function (response) {
              if (response.success) {
                if (response.added) {
                  icon.removeClass('bi-heart').addClass('bi-heart-fill');
                } else {
                  icon.removeClass('bi-heart-fill').addClass('bi-heart');

                  // ❗ Favoritdən silinibsə — kartı da gizlət
                  cardColumn.fadeOut(600, function () {
                    $(this).remove()
                  });
                }
              }
            }
          })
        })
      })
    </script>

  </body>


</html>
