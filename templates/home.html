<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Home</title>
    <!--Meta tags-->
    <meta name="description" content="Carleon olaraq, Cənubi Koreyanın ən yaxşı ikinci əl avtomobillərini Bakıdakı alıcılarla qovuşdururuq. Sektordakı təcrübəmiz və şəffaflıq prinsipimiz sayəsində, avtomobil idxalını mürəkkəb bir prosesdən çıxarırıq. Hər bir avtomobili alıcının gözləntilərini qarşılamaq üçün diqqətlə seçir, yoxlayır və qapınıza qədər çatdırırıq.">

    <meta name="keywords" content="car, Korea, Baku">

    <meta property="og:title" content="Koreya Keyfiyyəti, Bakı Yollarında.">
    <meta property="og:description" content="Carleon olaraq, Cənubi Koreyanın ən yaxşı ikinci əl avtomobillərini Bakıdakı alıcılarla qovuşdururuq. Sektordakı təcrübəmiz və şəffaflıq prinsipimiz sayəsində, avtomobil idxalını mürəkkəb bir prosesdən çıxarırıq. Hər bir avtomobili alıcının gözləntilərini qarşılamaq üçün diqqətlə seçir, yoxlayır və qapınıza qədər çatdırırıq.">

    <meta property="og:image" content="https://scontent.fgyd20-2.fna.fbcdn.net/v/t39.30808-6/467189249_877114524407522_6986230217856228068_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=6ee11a&_nc_ohc=uuNUo-9SdjEQ7kNvwFRrMbZ&_nc_oc=AdnJ5wvM3PZmpZk3pw0eqkPgXQf-jD6Ho9WhNuWE6TSdZ8ZryU4h2y3TyTukHASshGE&_nc_zt=23&_nc_ht=scontent.fgyd20-2.fna&_nc_gid=jEWV73Amx4kEL9fVhze76w&oh=00_AfnlsMETbkJH0cLIo1hp5lSvaE6f90wPnWhfcYc5gqoYfg&oe=6943454C">

    <meta property="og:url" content="{{ request.scheme }}://{{ request.get_host }}">

    <link rel="canonical" href="{{ request.scheme }}://{{ request.get_host }}">

    <meta property="og:type" content="website">

    <meta property="og:site_name" content="Carleon">

    <link rel="icon" href="https://scontent.fgyd20-2.fna.fbcdn.net/v/t39.30808-6/467189249_877114524407522_6986230217856228068_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=6ee11a&_nc_ohc=uuNUo-9SdjEQ7kNvwFRrMbZ&_nc_oc=AdnJ5wvM3PZmpZk3pw0eqkPgXQf-jD6Ho9WhNuWE6TSdZ8ZryU4h2y3TyTukHASshGE&_nc_zt=23&_nc_ht=scontent.fgyd20-2.fna&_nc_gid=jEWV73Amx4kEL9fVhze76w&oh=00_AfnlsMETbkJH0cLIo1hp5lSvaE6f90wPnWhfcYc5gqoYfg&oe=6943454C" type="image/x-icon">




    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" />
    <link rel="stylesheet" href="/static/index.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.css" />
    <!-- HTMX -->
    <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.8/dist/htmx.min.js"></script>

    <!-- Alpine.js -->
    <script src="//unpkg.com/alpinejs" defer></script>
  </head>

  <body class="font-inter">
    {% include "partials/navbar.html" %}

    <div class="container mt-5">
      <div class="row">
        <!-- Filter -->
        <div class="col-12 col-lg-3 order-lg-1">
          {% include 'partials/filter.html' %}
        </div>

        <!-- Cars -->
        <div class="col-12 col-lg-9 order-lg-2">
          <div class="row">
            <div class="col-6 col-lg-3 mb-2">
              <a href="{% url 'favorite-cars' %}" class="text-decoration-none">
                <div class="card favorites-card text-center h-100">
                  <div class="card-body d-flex flex-column justify-content-center align-items-center">
                    <h5 class="card-title">Favorites</h5>
                    <p class="card-text">Sizin favori avtomobilləriniz</p>
                    <i class="bi bi-heart-fill favorite-icon"></i>
                  </div>
                </div>
              </a>
            </div>

          <!--Car cards-->
          {% for car in cars %}
            {% include "partials/cars.html" %}
          {% endfor %}
          </div>

          <div class="row my-3">
            <div class="col">
              <nav aria-label="Page navigation example">
                <ul class="pagination justify-content-center">
                  {# Previous #}
                  {% if page_obj.has_previous %}
                    <li class="page-item">
                      <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Əvvəlki</a>
                    </li>
                  {% else %}
                    <li class="page-item disabled">
                      <a class="page-link">Əvvəlki</a>
                    </li>
                  {% endif %}

                  {# First page #}
                  {% if page_obj.number > 2 %}
                    <li class="page-item">
                      <a class="page-link" href="?page=1">1</a>
                    </li>
                    {% if page_obj.number > 3 %}
                      <li class="page-item disabled">
                        <a class="page-link">…</a>
                      </li>
                    {% endif %}
                  {% endif %}

                  {# Current -1, current, current +1 #}
                  {% for num in page_obj.paginator.page_range %}
                    {% if num >= page_obj.number|add:'-1' and num <= page_obj.number|add:'1' %}
                      {% if page_obj.number == num %}
                        <li class="page-item active">
                          <a class="page-link">{{ num }}</a>
                        </li>
                      {% else %}
                        <li class="page-item">
                          <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                        </li>
                      {% endif %}
                    {% endif %}
                  {% endfor %}

                  {# Last page #}
                  {% if page_obj.number < page_obj.paginator.num_pages|add:'-1' %}
                    {% if page_obj.number < page_obj.paginator.num_pages|add:'-2' %}
                      <li class="page-item disabled">
                        <a class="page-link">…</a>
                      </li>
                    {% endif %}
                    <li class="page-item">
                      <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">{{ page_obj.paginator.num_pages }}</a>
                    </li>
                  {% endif %}

                  {# Next #}
                  {% if page_obj.has_next %}
                    <li class="page-item">
                      <a class="page-link" href="?page={{ page_obj.next_page_number }}">Növbəti</a>
                    </li>
                  {% else %}
                    <li class="page-item disabled">
                      <a class="page-link">Növbəti</a>
                    </li>
                  {% endif %}
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="/static/year-range.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js" integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y" crossorigin="anonymous"></script>
  </body>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function () {
      $('.favorite-icon').click(function () {
        var icon = $(this)
        var carId = icon.data('car-id')
    
        $.ajax({
          url: "{% url 'toggle_favorite' %}",
          method: 'POST',
          data: {
            car_id: carId,
            csrfmiddlewaretoken: '{{ csrf_token }}'
          },
          success: function (response) {
            if (response.success) {
              if (response.added) {
                icon.removeClass('bi-heart').addClass('bi-heart-fill')
              } else {
                icon.removeClass('bi-heart-fill').addClass('bi-heart')
              }
            }
          }
        })
      })
    })
    
    function carFilter(initialBrand = null, initialModel = null) {
      return {
        models: [],
        selected_model: initialModel,
        init() {
          if (initialBrand) {
            // əgər reload zamanı marka seçilibsə, modelləri fetch et
            this.fetchModels(initialBrand)
          }
        },
        updateModels(event) {
          const brandId = event.target.value
          this.selected_model = null // əvvəlki modeli reset et
          if (!brandId) {
            this.models = []
            return
          }
          this.fetchModels(brandId)
        },
        fetchModels(brandId) {
          fetch(`/ajax/models/${brandId}/`)
            .then((res) => res.json())
            .then((data) => {
              this.models = data
              // əgər initial model serverdən varsa, onu seç
              if (this.selected_model) {
                const exists = this.models.find((m) => m.id === this.selected_model)
                if (!exists) this.selected_model = null
              }
            })
            .catch((err) => {
              console.error('Failed to fetch models', err)
              this.models = []
            })
        }
      }
    }
  </script>
</html>
